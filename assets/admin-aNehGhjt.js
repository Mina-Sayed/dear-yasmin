const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/intro-Cm5SSENS.js","assets/index-AkPmfAVE.js","assets/index-Bwl-VxQ_.css"])))=>i.map(i=>d[i]);
import{a as e,n as t,r as n}from"./index-AkPmfAVE.js";var r=class{sm;eventListeners=[];photos=[];audio=null;constructor(e){this.sm=e}async enter(){n.showScreen(`admin-screen`),this.eventListeners=[];try{await e.init()}catch(e){console.error(`Failed to init storage:`,e),alert(`Storage not supported in this browser`),this.returnToIntro();return}this.setupEventListeners(),await this.loadExistingAssets(),this.updateUI()}setupEventListeners(){let e=document.getElementById(`admin-photo-input`),t=document.getElementById(`admin-add-photo`);if(t&&e){let n=()=>e.click();t.addEventListener(`click`,n),this.eventListeners.push({el:t,type:`click`,handler:n});let r=e=>this.handlePhotoUpload(e);e.addEventListener(`change`,r),this.eventListeners.push({el:e,type:`change`,handler:r})}let n=document.getElementById(`admin-audio-input`),r=document.getElementById(`admin-add-audio`);if(r&&n){let e=()=>n.click();r.addEventListener(`click`,e),this.eventListeners.push({el:r,type:`click`,handler:e});let t=e=>this.handleAudioUpload(e);n.addEventListener(`change`,t),this.eventListeners.push({el:n,type:`change`,handler:t})}let i=document.getElementById(`admin-back`);if(i){let e=()=>this.returnToIntro();i.addEventListener(`click`,e),this.eventListeners.push({el:i,type:`click`,handler:e})}let a=document.getElementById(`admin-reset`);if(a){let e=()=>this.resetToDefaults();a.addEventListener(`click`,e),this.eventListeners.push({el:a,type:`click`,handler:e})}}async handlePhotoUpload(t){let n=t.target,r=n.files;if(!(!r||r.length===0)){for(let t of Array.from(r)){if(!t.type.startsWith(`image/`)){console.warn(`Skipping non-image file:`,t.name);continue}let n=`photo_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;try{await e.saveAsset(n,`photo`,t.name,t),this.sm.audio.play(`click`)}catch(e){console.error(`Failed to save photo:`,e)}}n.value=``,await this.loadExistingAssets(),this.updateUI()}}async handleAudioUpload(t){let n=t.target,r=n.files;if(!r||r.length===0)return;let i=r[0];if(!i.type.startsWith(`audio/`)){alert(`Please select an audio file`);return}this.audio&&await e.deleteAsset(this.audio.id);let a=`bgm_${Date.now()}`;try{await e.saveAsset(a,`audio`,i.name,i),await e.setConfig(`useCustomBGM`,!0),this.sm.audio.play(`click`)}catch(e){console.error(`Failed to save audio:`,e)}n.value=``,await this.loadExistingAssets(),this.updateUI()}async loadExistingAssets(){let t=await e.getAllAssets();this.photos=t.filter(e=>e.type===`photo`),this.audio=t.find(e=>e.type===`audio`)||null}updateUI(){let e=document.getElementById(`admin-photo-list`);e&&(this.photos.length===0?e.innerHTML=`<p style="color: #888; text-align: center;">No photos uploaded yet</p>`:(e.innerHTML=this.photos.map((e,t)=>`
                    <div class="admin-item" data-id="${e.id}" style="display: flex; flex-direction: column; gap: 8px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px; margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${e.url}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; flex-shrink: 0;">
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 0.85rem; color: #888; margin-bottom: 4px;">Slide ${t+1}</div>
                                <div style="font-size: 0.9rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${e.name}</div>
                            </div>
                            <button class="admin-delete-photo" data-id="${e.id}" style="background: #e91e63; padding: 6px 12px; font-size: 0.8rem; flex-shrink: 0;">Delete</button>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1rem;">ðŸ’¬</span>
                            <input type="text" class="admin-photo-text" data-id="${e.id}" 
                                value="${e.text||``}" 
                                placeholder="Enter a sweet message for this photo..."
                                style="flex: 1; padding: 8px 12px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white; font-size: 0.9rem;">
                            <button class="admin-save-text" data-id="${e.id}" style="background: #4caf50; padding: 6px 12px; font-size: 0.8rem; flex-shrink: 0;">Save</button>
                        </div>
                    </div>
                `).join(``),e.querySelectorAll(`.admin-delete-photo`).forEach(e=>{let t=e=>{let t=e.target.getAttribute(`data-id`);this.deletePhoto(t)};e.addEventListener(`click`,t),this.eventListeners.push({el:e,type:`click`,handler:t})}),e.querySelectorAll(`.admin-save-text`).forEach(t=>{let n=t=>{let n=t.target.getAttribute(`data-id`),r=e.querySelector(`.admin-photo-text[data-id="${n}"]`);r&&this.savePhotoText(n,r.value)};t.addEventListener(`click`,n),this.eventListeners.push({el:t,type:`click`,handler:n})}),e.querySelectorAll(`.admin-photo-text`).forEach(e=>{let t=e=>{if(e.key===`Enter`){let t=e.target.getAttribute(`data-id`);this.savePhotoText(t,e.target.value)}};e.addEventListener(`keypress`,t),this.eventListeners.push({el:e,type:`keypress`,handler:t})})));let t=document.getElementById(`admin-audio-info`);if(t)if(this.audio){t.innerHTML=`
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                        <span style="font-size: 1.5rem;">ðŸŽµ</span>
                        <span style="flex: 1; font-size: 0.9rem;">${this.audio.name}</span>
                        <button id="admin-delete-audio" style="background: #e91e63; padding: 6px 12px; font-size: 0.8rem;">Delete</button>
                    </div>
                    <audio controls style="width: 100%; margin-top: 10px;" src="${this.audio.url}"></audio>
                `;let e=document.getElementById(`admin-delete-audio`);if(e){let t=()=>this.deleteAudio();e.addEventListener(`click`,t),this.eventListeners.push({el:e,type:`click`,handler:t})}}else t.innerHTML=`<p style="color: #888; text-align: center;">No custom audio uploaded</p>`;this.updatePreview()}updatePreview(){let e=document.getElementById(`admin-preview`);if(e){if(this.photos.length===0){e.innerHTML=`<p style="color: #888; text-align: center;">Upload photos to see preview</p>`;return}e.innerHTML=`
            <div style="text-align: center; margin-bottom: 10px; color: var(--primary);">
                Slideshow will show ${this.photos.length} photo(s)
            </div>
            <div style="max-height: 250px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                ${this.photos.map((e,t)=>`
                    <div style="display: flex; align-items: center; gap: 10px; padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <img src="${e.url}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px; flex-shrink: 0;">
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 0.75rem; color: #888;">Slide ${t+1}</div>
                            <div style="font-size: 0.9rem; color: #fff; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${e.text||`(no text)`}</div>
                        </div>
                    </div>
                `).join(``)}
            </div>
        `}}async deletePhoto(t){try{await e.deleteAsset(t),this.sm.audio.play(`click`),await this.loadExistingAssets(),this.updateUI()}catch(e){console.error(`Failed to delete photo:`,e)}}async savePhotoText(t,n){try{await e.updatePhotoText(t,n),this.sm.audio.play(`click`);let r=document.querySelector(`.admin-save-text[data-id="${t}"]`);if(r){let e=r.innerText;r.innerText=`âœ“ Saved`,r.style.background=`#2196f3`,setTimeout(()=>{r.innerText=e,r.style.background=`#4caf50`},1500)}let i=this.photos.find(e=>e.id===t);i&&(i.text=n)}catch(e){console.error(`Failed to save photo text:`,e),alert(`Failed to save text`)}}async deleteAudio(){if(this.audio)try{await e.deleteAsset(this.audio.id),await e.setConfig(`useCustomBGM`,!1),this.sm.audio.play(`click`),await this.loadExistingAssets(),this.updateUI()}catch(e){console.error(`Failed to delete audio:`,e)}}async resetToDefaults(){if(confirm(`This will delete all custom photos and audio. Continue?`))try{let t=await e.getAllAssets();for(let n of t)await e.deleteAsset(n.id);await e.setConfig(`useCustomBGM`,!1),this.photos=[],this.audio=null,this.sm.audio.play(`click`),this.updateUI()}catch(e){console.error(`Failed to reset:`,e)}}returnToIntro(){t(async()=>{let{IntroState:e}=await import(`./intro-Cm5SSENS.js`);return{IntroState:e}},__vite__mapDeps([0,1,2])).then(({IntroState:e})=>{this.sm.changeState(new e(this.sm))})}update(e){}draw(e){e.clear(`#1a1a2e`)}exit(){this.eventListeners.forEach(({el:e,type:t,handler:n})=>{e.removeEventListener(t,n)}),this.eventListeners=[],n.hideScreen(`admin-screen`)}resize(e,t){}};export{r as AdminState};