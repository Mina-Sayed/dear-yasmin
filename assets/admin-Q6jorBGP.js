const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/intro-Bqu3fRRY.js","assets/index-DEktv6i2.js","assets/index-Bwl-VxQ_.css"])))=>i.map(i=>d[i]);
import{a as e,i as t,n,r}from"./index-DEktv6i2.js";var i=class{sm;eventListeners=[];photos=[];audio=null;constructor(e){this.sm=e}async enter(){r.showScreen(`admin-screen`),this.eventListeners=[];try{await e.init()}catch(e){console.error(`Failed to init storage:`,e),alert(`Storage not supported in this browser`),await this.returnToIntro();return}this.setupEventListeners(),await this.loadExistingAssets(),this.updateUI()}setupEventListeners(){let e=document.getElementById(`admin-photo-input`),t=document.getElementById(`admin-add-photo`);if(t&&e){let n=()=>e.click();t.addEventListener(`click`,n),this.eventListeners.push({el:t,type:`click`,handler:n});let r=e=>{this.handlePhotoUpload(e)};e.addEventListener(`change`,r),this.eventListeners.push({el:e,type:`change`,handler:r})}let n=document.getElementById(`admin-audio-input`),r=document.getElementById(`admin-add-audio`);if(r&&n){let e=()=>n.click();r.addEventListener(`click`,e),this.eventListeners.push({el:r,type:`click`,handler:e});let t=e=>{this.handleAudioUpload(e)};n.addEventListener(`change`,t),this.eventListeners.push({el:n,type:`change`,handler:t})}let i=document.getElementById(`admin-back`);if(i){let e=()=>{this.returnToIntro()};i.addEventListener(`click`,e),this.eventListeners.push({el:i,type:`click`,handler:e})}let a=document.getElementById(`admin-reset`);if(a){let e=()=>{this.resetToDefaults()};a.addEventListener(`click`,e),this.eventListeners.push({el:a,type:`click`,handler:e})}}async handlePhotoUpload(t){let n=t.target,r=n.files;if(!(!r||r.length===0)){for(let t of Array.from(r)){if(!this.isSupportedImageFile(t)){console.warn(`Skipping non-image file:`,t.name);continue}let n=`photo_${Date.now()}_${Math.random().toString(36).slice(2,11)}`;try{await e.saveAsset(n,`photo`,t.name,t),this.sm.audio.play(`click`)}catch(e){console.error(`Failed to save photo:`,e)}}n.value=``,await this.loadExistingAssets(),this.updateUI()}}isSupportedImageFile(e){if(e.type.startsWith(`image/`))return!0;let t=e.name.toLowerCase();return t.endsWith(`.heic`)||t.endsWith(`.heif`)}async handleAudioUpload(t){let n=t.target,r=n.files;if(!r||r.length===0)return;let i=r[0];if(!i.type.startsWith(`audio/`)){alert(`Please select an audio file`);return}this.audio&&await e.deleteAsset(this.audio.id);let a=`bgm_${Date.now()}`;try{await e.saveAsset(a,`audio`,i.name,i),await e.setConfig(`useCustomBGM`,!0),this.sm.audio.play(`click`)}catch(e){console.error(`Failed to save audio:`,e)}n.value=``,await this.loadExistingAssets(),this.updateUI()}async loadExistingAssets(){let t=await e.getAllAssets();this.photos=t.filter(e=>e.type===`photo`),this.audio=t.find(e=>e.type===`audio`)||null}clearChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}createEmptyMessage(e){let t=document.createElement(`p`);return t.style.cssText=`color: #888; text-align: center;`,t.textContent=e,t}createPhotoItem(e,t){let n=document.createElement(`div`);n.className=`admin-item`,n.dataset.id=e.id,n.style.cssText=`display: flex; flex-direction: column; gap: 8px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 8px; margin-bottom: 10px;`;let r=document.createElement(`div`);r.style.cssText=`display: flex; align-items: center; gap: 10px;`;let i=document.createElement(`img`);i.src=e.url,i.style.cssText=`width: 60px; height: 60px; object-fit: cover; border-radius: 4px; flex-shrink: 0;`;let a=document.createElement(`div`);a.style.cssText=`flex: 1; min-width: 0;`;let o=document.createElement(`div`);o.style.cssText=`font-size: 0.85rem; color: #888; margin-bottom: 4px;`,o.textContent=`Slide ${t+1}`;let s=document.createElement(`div`);s.style.cssText=`font-size: 0.9rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;`,s.textContent=e.name,a.append(o,s);let c=document.createElement(`button`);c.className=`admin-delete-photo`,c.dataset.id=e.id,c.style.cssText=`background: #e91e63; padding: 6px 12px; font-size: 0.8rem; flex-shrink: 0;`,c.textContent=`Delete`,c.onclick=()=>{this.deletePhoto(e.id)},r.append(i,a,c);let l=document.createElement(`div`);l.style.cssText=`display: flex; align-items: center; gap: 8px;`;let u=document.createElement(`span`);u.style.cssText=`font-size: 1rem;`,u.textContent=`ðŸ’¬`;let d=document.createElement(`input`);d.type=`text`,d.className=`admin-photo-text`,d.dataset.id=e.id,d.value=e.text||``,d.placeholder=`Enter a sweet message for this photo...`,d.style.cssText=`flex: 1; padding: 8px 12px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white; font-size: 0.9rem;`,d.onkeydown=t=>{t.key===`Enter`&&this.savePhotoText(e.id,d.value)};let f=document.createElement(`button`);return f.className=`admin-save-text`,f.dataset.id=e.id,f.style.cssText=`background: #4caf50; padding: 6px 12px; font-size: 0.8rem; flex-shrink: 0;`,f.textContent=`Save`,f.onclick=()=>{this.savePhotoText(e.id,d.value)},l.append(u,d,f),n.append(r,l),n}createAudioSection(e){let t=document.createElement(`div`),n=document.createElement(`div`);n.style.cssText=`display: flex; align-items: center; gap: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;`;let r=document.createElement(`span`);r.style.cssText=`font-size: 1.5rem;`,r.textContent=`ðŸŽµ`;let i=document.createElement(`span`);i.style.cssText=`flex: 1; font-size: 0.9rem;`,i.textContent=e.name;let a=document.createElement(`button`);a.style.cssText=`background: #e91e63; padding: 6px 12px; font-size: 0.8rem;`,a.textContent=`Delete`,a.onclick=()=>{this.deleteAudio()},n.append(r,i,a);let o=document.createElement(`audio`);return o.controls=!0,o.src=e.url,o.style.cssText=`width: 100%; margin-top: 10px;`,t.append(n,o),t}createPreviewItem(e,t){let n=document.createElement(`div`);n.style.cssText=`display: flex; align-items: center; gap: 10px; padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);`;let r=document.createElement(`img`);r.src=e.url,r.style.cssText=`width: 50px; height: 50px; object-fit: cover; border-radius: 6px; flex-shrink: 0;`;let i=document.createElement(`div`);i.style.cssText=`flex: 1; min-width: 0;`;let a=document.createElement(`div`);a.style.cssText=`font-size: 0.75rem; color: #888;`,a.textContent=`Slide ${t+1}`;let o=document.createElement(`div`);return o.style.cssText=`font-size: 0.9rem; color: #fff; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;`,o.textContent=e.text||`(no text)`,i.append(a,o),n.append(r,i),n}updateUI(){let e=document.getElementById(`admin-photo-list`);e&&(this.clearChildren(e),this.photos.length===0?e.appendChild(this.createEmptyMessage(`No photos uploaded yet`)):this.photos.forEach((t,n)=>{e.appendChild(this.createPhotoItem(t,n))}));let t=document.getElementById(`admin-audio-info`);t&&(this.clearChildren(t),this.audio?t.appendChild(this.createAudioSection(this.audio)):t.appendChild(this.createEmptyMessage(`No custom audio uploaded`))),this.updatePreview()}updatePreview(){let e=document.getElementById(`admin-preview`);if(!e)return;if(this.clearChildren(e),this.photos.length===0){e.appendChild(this.createEmptyMessage(`Upload photos to see preview`));return}let t=document.createElement(`div`);t.style.cssText=`text-align: center; margin-bottom: 10px; color: var(--primary);`,t.textContent=`Slideshow will show ${this.photos.length} photo(s)`;let n=document.createElement(`div`);n.style.cssText=`max-height: 250px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;`,this.photos.forEach((e,t)=>{n.appendChild(this.createPreviewItem(e,t))}),e.append(t,n)}async deletePhoto(t){try{await e.deleteAsset(t),this.sm.audio.play(`click`),await this.loadExistingAssets(),this.updateUI()}catch(e){console.error(`Failed to delete photo:`,e)}}async savePhotoText(t,n){try{await e.updatePhotoText(t,n),this.sm.audio.play(`click`);let r=document.querySelector(`.admin-save-text[data-id="${t}"]`);if(r){let e=r.innerText;r.innerText=`âœ“ Saved`,r.style.background=`#2196f3`,setTimeout(()=>{r.innerText=e,r.style.background=`#4caf50`},1500)}let i=this.photos.find(e=>e.id===t);i&&(i.text=n),this.updatePreview()}catch(e){console.error(`Failed to save photo text:`,e),alert(`Failed to save text`)}}async deleteAudio(){if(this.audio)try{await e.deleteAsset(this.audio.id),await e.setConfig(`useCustomBGM`,!1),this.sm.audio.play(`click`),await this.loadExistingAssets(),this.updateUI()}catch(e){console.error(`Failed to delete audio:`,e)}}async resetToDefaults(){if(confirm(`This will delete all custom photos and audio. Continue?`))try{let t=await e.getAllAssets();for(let n of t)await e.deleteAsset(n.id);await e.setConfig(`useCustomBGM`,!1),this.photos=[],this.audio=null,this.sm.audio.play(`click`),this.updateUI()}catch(e){console.error(`Failed to reset:`,e)}}async syncRuntimeContent(){try{await t.loadCustomContent()}catch(e){console.error(`Failed to sync runtime content:`,e),t.resetToDefaults()}this.sm.audio.setupBGM()}async returnToIntro(){await this.syncRuntimeContent();let{IntroState:e}=await n(async()=>{let{IntroState:e}=await import(`./intro-Bqu3fRRY.js`);return{IntroState:e}},__vite__mapDeps([0,1,2]));this.sm.changeState(new e(this.sm))}update(e){}draw(e){e.clear(`#1a1a2e`)}exit(){this.eventListeners.forEach(({el:e,type:t,handler:n})=>{e.removeEventListener(t,n)}),this.eventListeners=[],r.hideScreen(`admin-screen`)}resize(e,t){}};export{i as AdminState};